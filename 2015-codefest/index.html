<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!--This one seems to work all the time, but really small on ipad-->
    <!--<meta name="viewport" content="initial-scale=0.4">-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" media="all" href="theme/css/default.css">
    <link rel="stylesheet" media="all" href="theme/css/custom.css">
    <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
    <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
    <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">
<slide class="logoslide nobackground">
    <article class="flexbox vcenter">
        <span><img src="images/logo.png" style="width: 97px; height: 125px;"/></span>
    </article>
</slide>
<slide>
    <hgroup>
        <h2>About Me</h2>
    </hgroup>
    <article class="">
            <p style="font-size: 1.4em;padding-top: 80px;">
    Victor Farazdagi (<a href="https://twitter.com/farazdagi">@farazdagi</a>):<br />
    <ul style="font-size: 1.2em;line-height: 1.4em;">
        <li>MSCS Student @ Georgia Tech. (Specialization: Systems)</li>
        <li>Chef Engineer @ Square Labs</li>
    </ul>
    </p>

    <img style="position: absolute; bottom: 90px; right: 200px; width: 160px;" src="images/square-labs-logo.png" />
    <img style="position: absolute; bottom: 90px; left: 200px; width: 160px;" src="images/gatech.gif" />
    </article>
    <fgroup>
        <h3></h3>
    </fgroup>
    <aside class="note">
        <section>
                <p>
        Academic:<br />
    <ul>
        <li>BA in Political Sci. &amp; Int. Relations from Bosphorus Univ.</li>
        <li>BS in CS from Oregon State Univ.</li>
        <li>MSCS Student @ Georgia Tech. (Specialization: Systems)</li>
    </ul>
    </p>

    <p>
        Interests:<br />
    <ul>
        <li>Distributed Algorithms</li>
        <li>Computability &amp; Complexity</li>
    </ul>
    </p>

    <p>
        Social Media:<br />
    <ul>
        <li><a href="https://twitter.com/farazdagi">@farazdagi</a></li>
        <li>github.com/farazdagi</li>
    </ul>
    </p>
        </section>
    </aside>
</slide>
<slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/logo.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
        <h1 data-config-title><!-- populated from slide_config.json --></h1>
        <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
        <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
</slide>

<!-- Section 1 -->
<!--<slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/logo.png"></aside>
    <hgroup class="auto-fadein">
        <h3>Часть 1</h3>
        <h2>Цели и задачи</h2>
    </hgroup>
</slide>
-->
        <slide>
    <hgroup>
        <h2>Paradigm Shift</h2>
    </hgroup>
    <article class="biggest">
            <p style="padding-top:100px;font-size:1.2em;line-height:1.2em;text-align:center;">
        What can we do to improve the security of the Internet?
    </p>
    <div class="build">
        <img style="position: absolute; bottom: 120px; left: 50px; width: 450px;" src="images/ie-is-pita.png" />
        <img style="position: absolute; bottom: 80px; right: 50px; width: 450px;" src="images/use-browser-experience.png" />
    </div>
    </article>
    <fgroup>
        <h3>CoreOS: Mission &amp; Goals</h3>
    </fgroup>
    <aside class="note">
        <section>
                <ul>
        <li>CoreOS Mission: Secure the internet</li>
        <li>Let's use browsers' experience (automatic updates)</li>
        <li>Alex Polvi: Ethos of CoreOS</li>
    </ul>
    <!--<img style="position: absolute; top: 80px; right: 50px; width: 200px;" src="images/small-cluster.png" />-->
        </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Warehouse-scale Machine</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>Clusters</li>
        <li>Redundancy and HA</li>
    </ul>
    <img style="position: absolute; top: 270px; left: 70px; width: 300px;" src="images/cpu-evolution.png" />
    <img style="position: absolute; top: 150px; right: 50px; width: 500px;" src="images/warehouse-scale-machine.png" />
    </article>
    <fgroup>
        <h3>CoreOS: Mission &amp; Goals</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Overall Architecture</h2>
    </hgroup>
    <article class="bigger">
            <img style="position: absolute; top: 160px; right: 50px;" src="images/redesigned-split.png" />
    <img style="position: absolute; top: 120px; left: 75px; width:400px;" src="images/previous-systems.png" />
    <div class="build">
    <img style="position: absolute; bottom: 61px; left: 75px; width:400px;" src="images/new-systems.png" />
    </div>
    </article>
    <fgroup>
        <h3>CoreOS: Mission &amp; Goals</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Top Features</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>Minimal (based on Gentoo)</li>
        <li>Secure (Automatic Updates)</li>
        <li>Designed for HA clusters</li>
    </ul>

    <p style="font-size: 0.8em; text-align: center; padding: 30px 50px;position: relative;">
    CoreOS is a new Linux distribution that has been rearchitected to provide features needed to run modern
    infrastructure stacks.
    <small style="position: absolute; bottom: 0; right: 90px; font-size: 0.6em;">from https://coreos.com</small>
    </p>
    </article>
    <fgroup>
        <h3>CoreOS: Mission &amp; Goals</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>CoreOS is..</h2>
    </hgroup>
    <article class="bigger">
            <img style="position: absolute; top: 150px; left: 230px; width: 600px;" src="images/coreos-is.png" />
    </article>
    <fgroup>
        <h3>CoreOS: Mission &amp; Goals</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>

<!-- Section 2 -->
<!--<slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/logo.png"></aside>
    <hgroup class="auto-fadein">
        <h3>Часть 2</h3>
        <h2>Using Clusters</h2>
    </hgroup>
</slide>
-->
        <slide>
    <hgroup>
        <h2>Why containers?</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>Containers vs VMs (wrong dichotomy)</li>
        <li>Containers imply distributed architecture</li>
    </ul>
    <img style="position: absolute; top: 270px; left: 250px; width: 500px;" src="images/containers-vs-vms.png" />
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
            <ul>
    <li>VMs and Containers can be used together</li>
    <li>Containers should run on bare metal for the best performance though</li>
</ul>
        </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Docker</h2>
    </hgroup>
    <article class="bigger">
            <pre class="prettyprint" data-lang="zsh">
$ sudo docker run ubuntu /bin/echo 'hello world'
$ sudo docker run -i -t ubuntu /bin/bash
    </pre>
    <h3>It is trivial:</h3>
    <ul style="font-size: 26px;line-height: 28px;">
        <li>Create Images i.e. Dockerizing Apps</li>
        <li>Distributing images and running containers</li>
        <li>Linking containers together</li>
        <li>Managing data using volumes<br />and volume containers</li>
    </ul>

    <img style="position: absolute; bottom: 80px; right: 50px; width: 500px;" src="images/docker-architecture.png" />
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Dockerizing Apps: App Source Code</h2>
    </hgroup>
    <article class="bigger">
            <pre class="prettyprint" data-lang="go">
package main

import (
        "fmt"
        "html"
        "log"
        "net/http"
)

func main() {
        http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
                fmt.Fprintf(w, "Hello %s", html.EscapeString(r.URL.Path))
                log.Println("GET", html.EscapeString(r.URL.Path))
        })

        log.Fatal(http.ListenAndServe(":8080", nil))
}</pre>
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Dockerizing Apps: Dockerfile</h2>
    </hgroup>
    <article class="bigger">
            <pre class="prettyprint" data-lang="dockerfile">
FROM golang:1.4

# Bundle app source
COPY . /go/src/github.com/farazdagi/dumbserver

# Install app
RUN cd /go/src/github.com/farazdagi/dumbserver; go install

EXPOSE  80
CMD ["dumbserver"]
    </pre>
    <ul>
        <li>Good example of gradual specialization of the image</li>
    </ul>
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Dockerizing Apps: Results</h2>
    </hgroup>
    <article class="bigger">
            <pre class="prettyprint" data-lang="zsh">
$ sudo docker build -t farazdagi/dumbserver
$ sudo docker run -d -p 5577:80 farazdagi/dumbserver</pre>

    <h3>Now we can query our dumb server:</h3>
    <pre class="prettyprint" data-lang="zsh" style="font-size: 18px; line-height: 22px;">
$ http GET localhost:5577
HTTP/1.1 200 OK
Content-Length: 7
Content-Type: text/plain; charset=utf-8
Date: Thu, 12 Feb 2015 21:32:23 GMT

Hello /

$ http GET localhost:5577/foo/bar
HTTP/1.1 200 OK
Content-Length: 14
Content-Type: text/plain; charset=utf-8
Date: Thu, 12 Feb 2015 21:32:28 GMT

Hello /foo/bar</pre>

    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Rocket Runtime</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>Docker quickly becoming a platform not just Container Runtime</li>
        <li>App Container is a specification of an image format, runtime, and discovery protocol for running a
            container.</li>
        <li>Rocket is in early stages, Docker will be supported (or so they say)</li>
    </ul>
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
            <P>
Unfortunately, a simple re-usable component is not how things are playing out. Docker now is building tools for
launching cloud servers, systems for clustering, and a wide range of functions: building images, running images,
uploading, downloading, and eventually even overlay networking, all compiled into one monolithic binary running
primarily as root on your server. The standard container manifesto was removed. We should stop talking about Docker
containers, and start talking about the Docker Platform. It is not becoming the simple composable building block we had
envisioned.
</P>
        </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>So why containers?</h2>
    </hgroup>
    <article class="bigger">
            <h1 style="margin-top: 200px;text-align: center;" class="build">Because they are fast, portable and lightweight.</h1>
    <img style="position: absolute; bottom: 60px; right: 50px; width: 350px;" src="images/what-about-security.png" />
    </article>
    <fgroup>
        <h3>OS-level Virtualization aka Containerization</h3>
    </fgroup>
    <aside class="note">
        <section>
            Granted we have problems, like security, but those problems are solvable.
        </section>
    </aside>
</slide>

<!-- Section 3 -->
<!--<slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/logo.png"></aside>
    <hgroup class="auto-fadein">
        <h3>Часть 2</h3>
        <h2>Cluster Setup and Configuration</h2>
    </hgroup>
</slide>
-->
        <slide>
    <hgroup>
        <h2>cloud-config</h2>
    </hgroup>
    <article class="bigger">
            <ul class="smaller">
        <li>Configuration in YAML</li>
        <li>Configuration is parsed and corresponsing systemd unit files are generated.</li>
        <li>Allows you to setup:
            <ul>
                <li>Discovery parameters</li>
                <li>Configure systemd units</li>
                <li>Network</li>
                <li>SSH keys and Users</li>
            </ul>
        </li>
    </ul>
    <img style="position: absolute; bottom: 60px; right: 50px; width: 350px;" src="images/cloud-config-function.png" />
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
            <ul>
    <li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-coreos-cluster-on-digitalocean">Setting up CoreOS cluster on DO</a></li>
</ul>
        </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>cloud-config: minimal example</h2>
    </hgroup>
    <article class="bigger">
        <pre class="prettyprint" data-lang="cloud-config">
#cloud-config

coreos:
  etcd:
    discovery: https://discovery.etcd.io/47f61dc8b1c4bcb4d9be296099fa57da
    addr: $private_ipv4:4001 # for multi-region and multi-cloud use $public_ipv4
    peer-addr: $private_ipv4:7001
  fleet:
    public-ip: $private_ipv4   # used by fleetctl client
  units:
    - name: etcd.service
      command: start
    - name: fleet.service
      command: start
</pre>
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
            <ul>
    <li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-coreos-cluster-on-digitalocean">Setting up CoreOS cluster on DO</a></li>
</ul>
<pre class="prettyprint" data-lang="cloud-config">
#cloud-config

coreos:
  etcd:
    # generate a new token for each unique cluster from https://discovery.etcd.io/new
    discovery: https://discovery.etcd.io/<token>
    # use $public_ipv4 if your datacenter of choice does not support private networking
    addr: $private_ipv4:4001
    peer-addr: $private_ipv4:7001
  fleet:
    public-ip: $private_ipv4   # used for fleetctl ssh command
  units:
    - name: etcd.service
      command: start
    - name: fleet.service
      command: start
</pre>
        </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>start DO cluster</h2>
    </hgroup>
    <article class="bigger">
            <img style="position: absolute; top: 120px; left: 150px; width: 600px;" src="images/start-do-droplet.png" />
<pre style="font-size: 16px; line-height: 18px;margin-top:160px;" class="prettyprint" data-lang="zsh">
read TOKEN
# provide token
read SSH_KEY_ID
# provide SSH key id

curl -X POST https://api.digitalocean.com/v2/droplets \
    -H 'Content-Type: application/json' \
    -H "Authorization: Bearer $TOKEN" \
    -d '
{
    "name":"core-1",
    "region":"ams3",
    "size":"512mb",
    "image":"coreos-stable",
    "ssh_keys":['$SSH_KEY_ID'],
    "backups":false,
    "private_networking":true,
    "user_data": "'"$(cat config/cloud-config.yaml | sed 's/"/\\"/g')"'"
}'</pre>
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Check DO cluster</h2>
    </hgroup>
    <article class="bigger">
        <h3>Create droplets:</h3>
<pre style="" class="prettyprint" data-lang="zsh">
$ env TOKEN=$TOKEN SSH_KEY_ID=$SSH_KEY_ID bin/create-droplet.sh core-1
$ env TOKEN=$TOKEN SSH_KEY_ID=$SSH_KEY_ID bin/create-droplet.sh core-2
$ env TOKEN=$TOKEN SSH_KEY_ID=$SSH_KEY_ID bin/create-droplet.sh core-3
</pre>

<h3>Login into any machine and check discovery:</h3>
<pre style="" class="prettyprint" data-lang="zsh">
# ssh into any of core-* boxes and see if cluster discovery actually worked:
core@core-1 ~ $ fleetctl list-machines
MACHINE         IP              METADATA
0bb7e700...     10.133.194.91   -
330a6b08...     10.133.194.90   -
eecedbb6...     10.133.194.85   -
</pre>
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Service Configuration &amp; Discovery (etcd)</h2>
    </hgroup>
    <article class="bigger">
        <p>etcd is:</p>
    <ul>
        <li>Actively developed (in Go)</li>
        <li>Distributed Key-Value Store</li>
        <li>Highly Available</li>
        <li>Automatic Leader Election (via Raft)</li>
        <li>Simple: CURLable HTTP API</li>
        <li>Fast: Ks of writes per second (per instance)</li>
    </ul>
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Sample etcd API usage</h2>
    </hgroup>
    <article class="bigger">
        <pre class="prettyprint" style="font-size: 20px; line-height: 21px;" data-lang="zsh">
core@core-1 ~ $ curl -L http://127.0.0.1:4001/version
etcd 0.4.6

core@core-1 ~ $ curl -L http://127.0.0.1:4001/v2/keys/foo -XPUT -d value=bar
{
    "action":"set",
    "node":{
        "key":"/foo",
        "value":"bar",
        "modifiedIndex":273,
        "createdIndex":273
    }
}

core@core-1 ~ $ curl -L http://127.0.0.1:4001/v2/keys/foo
{
    "action":"get",
    "node":{
        "key":"/foo",
        "value":"bar",
        "modifiedIndex":273,
        "createdIndex":273
    }
}
</pre>
<img style="position: absolute; top: 90px; left: 630px; width: 150px;" src="images/check-version.png" />
<img style="position: absolute; top: 230px; left: 730px; width: 150px;" src="images/set-key.png" />
<img style="position: absolute; top: 490px; left: 630px; width: 150px;" src="images/get-key-value.png" />
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>

<!-- Section 4 -->
<!--<slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/logo.png"></aside>
    <hgroup class="auto-fadein">
        <h3>Часть 3</h3>
        <h2>Managing Cluster</h2>
    </hgroup>
</slide>
-->
        <slide>
    <hgroup>
        <h2>systemd overview</h2>
    </hgroup>
    <article class="bigger">
            <p>systemd:</p>
    <ul>
        <li>init system: allows to start/stop/manage processes</li>
        <li>you manage Docker containers via systemd unit files</li>
        <li>built to replace Linux init system, and was successful in that regard</li>
    </ul>
    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>systemd: example</h2>
    </hgroup>
    <article class="bigger">
        <strong style="font-size: 24px;">/etc/systemd/system/dumbserver.service:</strong>
<pre class="prettyprint" style="font-size: 20px; line-height: 24px;" data-lang="ini">
[Unit]
Description=MyDumbServer
After=etcd.service
After=docker.service

[Service]
TimeoutStartSec=0
ExecStartPre=-/usr/bin/docker kill dumbserver
ExecStartPre=-/usr/bin/docker rm dumbserver
ExecStartPre=/usr/bin/docker pull farazdagi/dumbserver
ExecStart=/usr/bin/docker run --name dumbserver -p 80:80 farazdagi/dumbserver

ExecStartPost=/usr/bin/etcdctl set /services/dumbserver/%H running
ExecStop=/usr/bin/docker stop dumbserver
ExecStopPost=/usr/bin/etcdctl rm /services/dumbserver/%H

[Install]
WantedBy=multi-user.target
</pre>
    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>systemd: running the example</h2>
    </hgroup>
    <article class="bigger">
        <strong style="font-size: 24px;">Enable and start service:</strong>
<pre class="prettyprint" style="font-size: 20px; line-height: 24px;" data-lang="zsh">
$ cd /etc/systemd/system
$ sudo systemctl enable dumbserver.service
$ sudo systemctl start dumbserver.service
</pre>

<strong style="font-size: 24px;">Test Running Service:</strong>
<pre class="prettyprint" style="font-size: 20px; line-height: 24px;" data-lang="zsh">
$ curl -L localhost:80/foo/bar
Hello /foo/bar
$ docker ps
$ journalctl -f -u dumbserver.service
</pre>

<strong style="font-size: 24px;">Stop Service:</strong>
<pre class="prettyprint" style="font-size: 20px; line-height: 24px;" data-lang="zsh">
$ sudo systemctl stop dumbserver.service
</pre>

    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>fleet overview</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>tool that controls systemd at the cluster level</li>
        <li>normal systemd unit files + few fleet-specific properties</li>
    </ul>
    <img style="position: absolute; bottom: 80px; left: 200px; width: 600px;" src="images/fleet-architecture.png" />
    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>fleet: example</h2>
    </hgroup>
    <article class="bigger">
        <pre class="prettyprint" style="font-size: 20px; line-height: 25px;" data-lang="zsh">
[Unit]
Description=MyDumbServer
After=etcd.service
After=docker.service

[Service]
User=core
TimeoutStartSec=0
ExecStartPre=-/usr/bin/docker kill dumbserver
ExecStartPre=-/usr/bin/docker rm dumbserver
ExecStartPre=/usr/bin/docker pull farazdagi/dumbserver
ExecStart=/usr/bin/docker run --name dumbserver -p 80:80 farazdagi/dumbserver

ExecStartPost=/usr/bin/etcdctl set /services/dumbserver/%H:%i '{Host: %H, port: 80}'
ExecStop=/usr/bin/docker stop dumbserver
ExecStopPost=/usr/bin/etcdctl rm /services/dumbserver/%H:%i

[X-Fleet]
Conflicts=dumbserver@*.service
</pre>
    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>fleet: running the example</h2>
    </hgroup>
    <article class="bigger">
        <strong style="font-size: 22px;">Enable service:</strong>
<pre class="prettyprint" style="margin-bottom: 0;font-size: 18px; line-height: 22px;" data-lang="zsh">
$ fleetctl submit dumbserver\@.service
$ fleetctl list-unit-files
UNIT                    HASH    DSTATE          STATE           TARGET
dumbserver@.service     063a727 inactive        inactive
</pre>

<strong style="font-size: 22px;">Start Services:</strong>
<pre class="prettyprint" style="margin-bottom: 0;font-size: 18px; line-height: 22px;" data-lang="zsh">
$ fleetctl start dumbserver@1
Unit dumbserver@1.service launched on 00d1d58c.../10.133.194.85
$ fleetctl start dumbserver@2
Unit dumbserver@2.service launched on 3d567ffd.../10.133.194.91
</pre>

<strong style="font-size: 22px;">Test Services:</strong>
<pre class="prettyprint" style="font-size: 18px; line-height: 22px;" data-lang="zsh">
$ curl -L 10.133.194.85:80/foo/bar # returns: Hello /foo/bar
$ curl -L 10.133.194.91:80/foo/bar # returns: Hello /foo/bar
$ etcdctl ls /services/dumbserver
/services/dumbserver/core-1:1
/services/dumbserver/core-2:2
</pre>

    </article>
    <fgroup>
        <h3>Running Services in CoreOS Clusters</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Updating CoreOS</h2>
    </hgroup>
    <article class="bigger">
            <ul>
        <li>Omaha Protocol</li>
        <li>Pull based model</li>
        <li>Dual-partion scheme</li>
        <li>Reboot manager (locksmith)<br />
            <div class="smaller" style="margin-left: 50px;">
            Restart strategies:
            <ul>
                <li>wait for etcd lock</li>
                <li>best effort (default)</li>
                <li>immediate restart</li>
            </ul>
            </div>
        </li>
    </ul>
    <img style="position: absolute; bottom: 280px; right: 100px; width: 250px;" src="images/updating-coreos.png" />
    </article>
    <fgroup>
        <h3>Updating Cluster</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>
<slide>
    <hgroup>
        <h2>Clustering Approaches</h2>
    </hgroup>
    <article class="bigger">
        <div class="build">
    <img style="position: absolute; top: 160px; right: 50px; width: 350px;" src="images/etcd-on-all-nodes.png" />
    <img style="position: absolute; bottom: 80px; right: 50px; width: 400px;" src="images/etcd-testing-cluster.png" />
    <img style="position: absolute; top: 160px; left: 50px; width: 550px;" src="images/etcd-nodes.png" />
</div>
    </article>
    <fgroup>
        <h3>Cluster Setup &amp; Configuration</h3>
    </fgroup>
    <aside class="note">
        <section>
                    </section>
    </aside>
</slide>

<slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/logo.png"></aside>
    <article class="flexbox vleft auto-fadein">
        <h2>Thank You!</h2>
        <h2 style="position: absolute; top: 50px; left: 50px;">Conclusion &amp; Take-Aways</h2>
        <p>&nbsp;</p>
    </article>
    <p class="auto-fadein" data-config-contact>
        <!-- populated from slide_config.json -->
    </p>
</slide>


<slide class="backdrop"></slide>

</slides>

<script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
<script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>

